<html>
<head>
	<title>WebAudioPlayer</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script type="text/javascript" src="jquery.xdomainajax.js"></script>
	<script type="text/javascript" src="http://jplayer.org/2.1.0/js/jquery.jplayer.min.js"></script>
	
</head>

<body>
	<form action="javascript:updateContentUrl()">
		Content URL:
		<input type="text" id="content_url" size="60" value="http://mp3.hhe.cc/Red%20Hot%20Chili%20Peppers/">
		<input type="submit" value="update">
	</form>
	<div id="content_state"></div>
	<div id="player" class="jp-jplayer"></div>
	<div id="content"></div>
</body>

<script type="text/javascript">

String.prototype.endsWith = function(suffix) {
    return this.indexOf(suffix, this.length - suffix.length) !== -1;
};

$(document).ready(function() {
	console.log("document ready");

	$("#player").jPlayer({
		ready: function(ev) {
			console.log("jPlayer ready");
			
			updateContentUrl();			
		},
		swfPath: "http://www.jplayer.org/2.1.0/js"
	});

});

function updateContentUrl() {
	var url = content_url.value;
	console.log("update content URL: " + url);

	$("#content_state")
		.text("loading " + url + " ...")
		.css({"text-decoration":"blink", "color":"grey"});

	$.ajax({
		url: url,
		type: "GET",
		success: function(res) {
			$("#content_state").text("success!");

			$(res.responseText).find("a").each(function() {
				var linktext = $(this).text();
				var linkurl = url + $(this).attr("href");
				if(!linkurl.endsWith(".mp3")) return;

				console.log("found: " + linktext);
				jQuery("<li>", {
					html: jQuery("<a>", {
						href: linkurl,
						text: linktext
					})
				}).appendTo($("#content"));
			});

		},
		fail: function() {
			console.log("failed to load");
			$("#content_state")
				.text("failed to load")
				.css("color","red");
		}
	});
}

</script>

</html>
